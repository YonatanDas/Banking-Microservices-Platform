kube-prometheus-stack:
  # Disable admission webhooks entirely (both at chart and operator level)
  admissionWebhooks:
    enabled: false
    patch:
      enabled: false
  
  prometheusOperator:
    admissionWebhooks:
      enabled: false
      patch:
        enabled: false
      failurePolicy: Ignore
    # CRITICAL: Disable TLS to prevent volume mount for missing secret
    tls:
      enabled: false
  
  prometheus:
    prometheusSpec:
      retention: 15d
      #storageSpec:
        #volumeClaimTemplate:
        #  spec:
           # storageClassName: gp3
           # accessModes: ["ReadWriteOnce"]
           # resources:
           #   requests:
             #   storage: 50Gi

  grafana:
    adminPassword: external-secrets
    service:
      type: ClusterIP  # Internal only - access via port-forward
    persistence:
      enabled: false
      #size: 10Gi
    datasources:
      datasources.yaml:
        apiVersion: 1
        datasources:
          - name: Prometheus
            type: prometheus
            url: http://prometheus-operator-dev-ku-prometheus:9090
            isDefault: true
          - name: Loki
            type: loki
            url: http://loki-gateway:80
          - name: Tempo
            type: tempo
            url: http://tempo-dev:3100
            access: proxy
            jsonData:
              httpMethod: GET
              tracesToLogs:
                datasourceUid: loki
                tags: ['job', 'instance', 'pod', 'namespace']
                mappedTags: [{ key: 'service.name', value: 'service' }]
                mapTagNamesEnabled: false
                spanStartTimeShift: '1h'
                spanEndTimeShift: '1h'
                filterByTraceID: false
                filterBySpanID: false


# Argo CD Image Updater Configuration for Production Environment
# This file documents the Image Updater configuration
# Actual configuration is done via Application annotations (see banking-app-prod.yaml)

# Image Updater Settings:
# - Enabled via annotations in banking-app-prod.yaml
# - Write-back method: Git (commits changes to repository)
# - Update strategy: Semantic versioning with constraint (semver:^1.0.0)
# - Target branch: main
# - Target path: helm/environments/prod-env/values.yaml

# ECR Repository Mappings:
# - accounts: 063630846340.dkr.ecr.us-east-1.amazonaws.com/accounts
# - cards: 063630846340.dkr.ecr.us-east-1.amazonaws.com/cards
# - loans: 063630846340.dkr.ecr.us-east-1.amazonaws.com/loans
# - gatewayserver: 063630846340.dkr.ecr.us-east-1.amazonaws.com/gatewayserver

# Update Behavior:
# - Production uses constrained semver strategy (^1.0.0 = patch and minor only, no major)
# - Image Updater scans ECR for new tags matching semver pattern
# - When new image is found, updates values.yaml and commits to Git
# - Argo CD requires MANUAL sync (no auto-sync for production)
# - Manual approval required before deployment

# Security Considerations:
# - Production should NOT use automated Image Updater in most cases
# - Recommended: Disable Image Updater for prod, use manual tag promotion
# - Tag promotion should go through: dev → stag → prod workflow
# - Require manual review and approval for all production image updates

# Recommended Production Workflow:
# 1. Disable Image Updater annotations in banking-app-prod.yaml
# 2. Use GitHub Actions workflow to promote tested tags from staging
# 3. Create PR to update helm/environments/prod-env/values.yaml
# 4. Require approval before merging
# 5. After merge, manually sync Argo CD Application
# 6. Monitor deployment and rollback if needed

# To enable Image Updater (NOT RECOMMENDED FOR PROD):
# 1. Install Argo CD Image Updater in the cluster
# 2. Configure GitHub credentials in Argo CD
# 3. Ensure Image Updater has ECR read and Git write permissions
# 4. Annotations in banking-app-prod.yaml will be processed
# 5. Remember: Argo CD sync is still manual, so updates require approval

# To disable Image Updater (RECOMMENDED):
# - Remove or comment out annotations in banking-app-prod.yaml
# - Use manual tag promotion workflow instead

# Manual Image Tag Updates (RECOMMENDED FOR PROD):
# 1. Update image tags in helm/environments/prod-env/values.yaml
# 2. Create PR with tag change
# 3. Require code review and approval
# 4. Merge PR
# 5. Manually sync Argo CD Application via UI or CLI
# 6. Monitor deployment health

